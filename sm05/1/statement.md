|                      |       |
|----------------------|-------|
| **Time limit:**      | `1 s` |
| **Real time limit:** | `5 s` |
| **Memory limit:**    | `64M` |


### Problem sm05-1: c/allocator/malloc

Напишите подпрограммы `void *alloc_mem(size_t size)` и `void free_mem(void *ptr)`, которые
аллоцируют и высвобождают память на куче.

Подпрограмма `alloc_mem`:

* принимает один параметр `size` (32-битное беззнаковое число типа size_t) — минимальный размер (в байтах) блока памяти, который нужно аллоцировать;
* возвращает адрес блока памяти не менее чем требуемого размера либо NULL (0).

В тестирующей программе будет определена глобальная переменная `struct Block* freelist;`, в которой
хранится список свободных блоков памяти:

![](https://caos2023.myltsev.ru/cgi-bin/new-
client?SID=f85b951a3bcef85b&prob_id=25&action=194&file=image.png)

Структура `Block` определена следующим образом:

    
    
    struct Block {
        uint32_t size;
        struct Block* next;
    };

Поле `size` хранит (размер блока в байтах минус 4), поле `next` — адрес следующего блока в списке.
Если в списке есть блоки, у которых записанный размер не меньше size, `alloc_mem` должна удалить
первый такой блок из списка и вернуть вызывающей подпрограмме адрес тела этого блока (адрес блока,
увеличенный на 4).

Если в списке `freelist` подходящих блоков нет, то `alloc_mem` использует функцию `sbrk`, чтобы
запросить у системы `4 + actual_size` байт дополнительной памяти. `actual_size` вычисляется как
`max(4, align4(size))`, где align4 – операция округления вверх до числа, кратного 4.

Функция `sbrk` (см. `man sbrk`) объявлена в системном заголовочном файле `unistd.h`. Она возвращает
либо указатель на новый блок памяти заданного размера, полученный у операционной системы, либо (в
случае неудачи) специальное значение `(void *)(-1)`.

Если `sbrk` отработал успешно, то `alloc_mem` записывает `actual_size` в первое машинное слово
полученного участка памяти и возвращает адрес второго машинного слова.

В случае, если выделить память не удалось (результат `sbrk` -1), `alloc_mem` должна вернуть NULL.
При этом подпрограмма `alloc_mem` должна остаться работоспособной (иметь возможность в дальнейшем
выделить меньший объём памяти, если это возможно).

Подпрограмма `free_mem` принимает один параметр — адрес, который ранее вернула подпрограмма
`alloc_mem`. Соответствующий блок памяти должен быть добавлен в голову списка `freelist`.

